package forensics;

import java.net.HttpURLConnection;
import java.net.URL;
import java.util.*;

public class WebVulnerabilityScanner implements ForensicAnalyzer {

    @Override
    public void analyze() {
        Scanner scanner = new Scanner(System.in);

        System.out.print("Enter target URL: ");
        String target = scanner.nextLine();

        if (!target.startsWith("http")) {
            target = "http://" + target;
        }

        System.out.println("\nüîé Starting Vulnerability Scan on: " + target);

        checkExposedFiles(target);
        checkHttpHeaders(target);
        checkHttpMethods(target);

        System.out.println("\n‚úÖ Scan completed.");
    }

    public static void main(String[] args) {
        new WebVulnerabilityScanner().analyze();
    }

    private void checkExposedFiles(String target) {
        String[] commonFiles = {
                "robots.txt", ".env", "config.php", ".git/", "admin/"
        };

        System.out.println("\nüìÅ Checking for exposed files...");

        for (String path : commonFiles) {
            try {
                URL url = new URL(target + "/" + path);
                HttpURLConnection conn = (HttpURLConnection) url.openConnection();
                conn.setConnectTimeout(3000);

                int code = conn.getResponseCode();
                if (code == 200) {
                    System.out.println("‚ö†Ô∏è Accessible: " + url);
                }
                conn.disconnect();
            } catch (Exception ignored) {
            }
        }
    }

    private void checkHttpHeaders(String target) {
        System.out.println("\nüß† Checking HTTP headers...");

        try {
            HttpURLConnection conn =
                    (HttpURLConnection) new URL(target).openConnection();

            Map<String, List<String>> headers = conn.getHeaderFields();
            for (String key : headers.keySet()) {
                if ("Server".equalsIgnoreCase(key)
                        || "X-Powered-By".equalsIgnoreCase(key)) {
                    System.out.println("‚ö†Ô∏è Leaky Header: " + key);
                }
            }
            conn.disconnect();
        } catch (Exception e) {
            System.out.println("Header check failed.");
        }
    }

    private void checkHttpMethods(String target) {
        System.out.println("\nüîé Checking allowed HTTP methods...");

        try {
            HttpURLConnection conn =
                    (HttpURLConnection) new URL(target).openConnection();
            conn.setRequestMethod("OPTIONS");

            String methods = conn.getHeaderField("Allow");
            if (methods != null) {
                System.out.println("Allowed Methods: " + methods);
            }
            conn.disconnect();
        } catch (Exception e) {
            System.out.println("Method check failed.");
        }
    }
}
